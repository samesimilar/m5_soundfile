#N canvas 321 174 1155 647 12;
#X declare -lib m5_soundfile;
#X obj 28 22 declare -lib m5_soundfile;
#X msg 786 156 start recording when audio detected;
#X text 503 160 Message 'start' with a single float will wait to start recording until it detects audio above that level \; Message 'start' with 3 floats (a frame time code) will start recording at that specific time., f 30;
#X text 561 299 Message 'stop' with 3 float will stop at that particular time \; Message 'stop' \, alone \, will stop recording immediately (may take some indeterminate time to finish writing the buffer., f 27;
#X obj 220 220 m5_writesf~ 2, f 25;
#X obj 222 75 m5_ftc_anchor writeTimeID;
#X obj 223 39 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 35 79 loadbang;
#X obj 290 180 adc~ 1;
#X obj 220 179 r inW1;
#X msg 784 94 \; inW1 open rec.wav \; inW1 start \;;
#X msg 784 70 start recording now;
#X msg 786 185 \; inW1 open rec.wav \; inW1 start 0.1 \;;
#X msg 955 76 stop immediately;
#X msg 957 103 \; inW1 stop \;;
#X obj 220 114 print writeTimeID current time;
#X obj 140 272 print actual record start time;
#X obj 114 272 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 218 317 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 243 318 print final recording length;
#X msg 790 450 start on threshold and stop after 2s (sr=48k);
#X obj 434 495 m5_writesf~ 2, f 20;
#X obj 498 448 adc~ 1;
#X obj 438 448 r inW2;
#X msg 35 112 \; inW1 time writeTimeID \; inW2 time writeTimeID \;;
#X obj 433 532 m5_ftc_add 1 0 96000;
#X msg 433 558 \; inW2 stop \$1 \$2 \$3 \;;
#X obj 297 572 print W2 stop at;
#X msg 791 475 \; inW2 open rec.wav \; inW2 start 0.1 \;;
#X obj 387 533 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 600 537 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X text 315 596 get the actual start frame \, add 96000 frames and schedule stop frame, f 39;
#X text 149 340 out1: output actual start time if different \; out2: total frames written (on close) \; Once there is a message on out2 it is ok to open the file in an m5_readsf~ object, f 45;
#X obj 597 567 print final length W2;
#X text 777 22 try:;
#X text 966 45 don't forget to stop!;
#X text 794 531 Stop time is calculated after threshold is met and recording starts \; and automatically sent - see inW2, f 41;
#X connect 1 0 12 0;
#X connect 4 0 16 0;
#X connect 4 0 17 0;
#X connect 4 1 18 0;
#X connect 4 1 19 0;
#X connect 5 0 15 0;
#X connect 6 0 5 0;
#X connect 7 0 24 0;
#X connect 8 0 4 0;
#X connect 8 0 4 1;
#X connect 9 0 4 0;
#X connect 11 0 10 0;
#X connect 13 0 14 0;
#X connect 20 0 28 0;
#X connect 21 0 25 0;
#X connect 21 0 29 0;
#X connect 21 1 30 0;
#X connect 21 1 33 0;
#X connect 22 0 21 0;
#X connect 22 0 21 1;
#X connect 23 0 21 0;
#X connect 25 0 26 0;
#X connect 25 0 27 0;
